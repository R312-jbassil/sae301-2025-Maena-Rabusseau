---
// Props
const {
  id = 'lunettes-svg',
  forme = 'CLASSIQUE',
  couleur = 'NOIR',
  verres = 'TRANSPARENT',
  monture = 'ACETATE',
  class: className = '',
  width = '100%',
  height = 'auto'
} = Astro.props;
---

<div id={id} class={"lunettes-svg " + className} data-forme={forme} data-couleur={couleur} data-verres={verres} data-monture={monture}>
  <!-- Inline SVG (from user) -->
  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 595.28 841.89" role="img" aria-label="AperÃ§u lunettes" style={`width:${width};height:${height}`}>
    <defs>
      <style>
        .cls-1 { fill: #706f6f; mix-blend-mode: multiply; }
        .cls-2 { isolation: isolate; }
        .cls-3, .cls-4 { fill: #ffffff; }
        .cls-4 { stroke: #1d1d1b; stroke-miterlimit: 10; stroke-width: .5px; }
        .cls-5 { fill: none; opacity: .75; }
      </style>
    </defs>
    <g class="cls-2">
      <g id="branches">
        <path class="cls-4" d="M108.83,155.14s49.35-5.57,54.93-8.76,11.14-7.96,19.5-9.55,64.48-11.14,64.48-11.14c0,0,7.16-1.99,17.51,5.57s33.04,31.84,39.4,31.05c6.37-.8,9.55-9.55,7.56-13.53s-40.67-32.75-47.36-34.63c-9.53-2.68-21.89-2.39-37.02,0-15.12,2.39-116.22,23.34-116.22,23.34,0,0-13.13,6.12-2.79,17.66Z"/>
        <path class="cls-1" d="M308.24,150.76s-.31,6.15-3.98,5.57c-4.97-.78-35.82-33.83-46.17-32.24,0,0,8.53,2.71,18.46,11.64,6.51,5.86,34.42,37.85,31.69,15.03Z"/>
        <path class="cls-4" d="M374.79,179.65l90.54-29.78s22.13-5.63,25.35-4.02,17.71,30.58,17.71,33.8-2.42,14.01-5.63,14.89c-2.33.64-5.33.11-6.84-4.21-1.41-4.02-6.84-31.73-12.47-31.47s-50.7,15.95-50.7,15.95c0,0-13.28,6.44-18.91,11.27s-32.19,11.27-32.19,11.27c0,0-9.66-7.65-6.84-17.71Z"/>
        <path class="cls-1" d="M381.34,180.1s102.27-35.19,107.85-31.99c0,0-18.2,2.49-41.76,11.88s-66.09,22.03-66.09,22.03v-1.92Z"/>
        <path class="cls-1" d="M485.36,158.06s3.26,0,4.98,3.45,9.77,24.71,9.77,24.71c0,0,.77,4.98,5.17-2.68,0,0-3.07,9.56-5.36,6.79s-9.77-26.33-9.77-26.33c0,0-2.87-6.74-4.79-5.94Z"/>
      </g>
      <g id="monture-CLASSIQUE">
        <path class="cls-4" d="M385.31,180.81c-.24-3.41-9.57-5.22-12.71-6.4-3.14-1.18-15.7,1.96-15.7,1.96-12.17-3.14-54.55-9.03-78.88-9.03s-32.57,11.38-35.32,10.99c-2.75-.39-17.27-.78-23.55-1.96-6.28-1.18-5.1-14.13-39.25-26.48-34.14-12.35-68.29-12.42-68.29-12.42-13.35,4.66-6.76,18.49-6.76,18.49l2.05,6.35c4.32,2.03,3.14,10.52,4.71,23.08s7.46,28.65,14.13,38.46c6.67,9.81,31.79,20.8,44.35,21.19s23.55-1.96,31.79-15.31c8.24-13.34,16.88-36.89,16.88-36.89l10.2,1.57s2.91.31,5.35,3.09,4.43,8.03,7.6,17.31c7.56,22.1,25.12,39.25,25.12,39.25,0,0,5.6,7.43,33.44,12.66,23.08,4.34,42.7-2.46,42.7-2.46,17.72-7.17,21.63-44.96,21.63-44.96,0,0,1.83-13.3,7.81-16.65,7.37-4.14,8.27-4.44,12.71-5.32,3.61-.71.24-13.13,0-16.54ZM190.5,231.32c-9.42,5.1-32.18,7.06-46.31-3.92-14.13-10.99-20.8-30.22-22.76-52.98s7.1-25.23,7.1-25.23c0,0,14.88-.67,34.11,4.03,19.23,4.71,40.42,18.05,40.82,26.69.39,8.63-3.53,46.31-12.95,51.41ZM344.73,255.65c-9.03,4.32-21.47,4.71-31.93,3.92-10.46-.78-37.54-1.57-47.35-31.4,0,0-2.75-14.13-5.1-17.27-2.35-3.14-9.42-14.48-9.42-18.43,0-8.23,7.15-12.97,7.15-12.97,0,0,8.16-5.1,18.75-5.1,10.6,0,64.75,2.75,72.21,12.95,7.46,10.2,7.06,21.98,8.24,31.4,1.18,9.42-3.53,32.57-12.56,36.89Z"/>
      </g>
      <g id="monture-ROND" transform="translate(0,4) scale(0.98,0.95)">
        <path class="cls-4" d="M385.31,180.81c-.24-3.41-9.57-5.22-12.71-6.4-3.14-1.18-15.7,1.96-15.7,1.96-12.17-3.14-54.55-9.03-78.88-9.03s-32.57,11.38-35.32,10.99c-2.75-.39-17.27-.78-23.55-1.96-6.28-1.18-5.1-14.13-39.25-26.48-34.14-12.35-68.29-12.42-68.29-12.42-13.35,4.66-6.76,18.49-6.76,18.49l2.05,6.35c4.32,2.03,3.14,10.52,4.71,23.08s7.46,28.65,14.13,38.46c6.67,9.81,31.79,20.8,44.35,21.19s23.55-1.96,31.79-15.31c8.24-13.34,16.88-36.89,16.88-36.89l10.2,1.57s2.91.31,5.35,3.09,4.43,8.03,7.6,17.31c7.56,22.1,25.12,39.25,25.12,39.25,0,0,5.6,7.43,33.44,12.66,23.08,4.34,42.7-2.46,42.7-2.46,17.72-7.17,21.63-44.96,21.63-44.96,0,0,1.83-13.3,7.81-16.65,7.37-4.14,8.27-4.44,12.71-5.32,3.61-.71.24-13.13,0-16.54ZM190.5,231.32c-9.42,5.1-32.18,7.06-46.31-3.92-14.13-10.99-20.8-30.22-22.76-52.98s7.1-25.23,7.1-25.23c0,0,14.88-.67,34.11,4.03,19.23,4.71,40.42,18.05,40.82,26.69.39,8.63-3.53,46.31-12.95,51.41ZM344.73,255.65c-9.03,4.32-21.47,4.71-31.93,3.92-10.46-.78-37.54-1.57-47.35-31.4,0,0-2.75-14.13-5.1-17.27-2.35-3.14-9.42-14.48-9.42-18.43,0-8.23,7.15-12.97,7.15-12.97,0,0,8.16-5.1,18.75-5.1,10.6,0,64.75,2.75,72.21,12.95,7.46,10.2,7.06,21.98,8.24,31.4,1.18,9.42-3.53,32.57-12.56,36.89Z"/>
      </g>
      <g id="monture-CARRE" transform="translate(-3,2) scale(1.02,1.03) skewX(-4)">
        <path class="cls-4" d="M385.31,180.81c-.24-3.41-9.57-5.22-12.71-6.4-3.14-1.18-15.7,1.96-15.7,1.96-12.17-3.14-54.55-9.03-78.88-9.03s-32.57,11.38-35.32,10.99c-2.75-.39-17.27-.78-23.55-1.96-6.28-1.18-5.1-14.13-39.25-26.48-34.14-12.35-68.29-12.42-68.29-12.42-13.35,4.66-6.76,18.49-6.76,18.49l2.05,6.35c4.32,2.03,3.14,10.52,4.71,23.08s7.46,28.65,14.13,38.46c6.67,9.81,31.79,20.8,44.35,21.19s23.55-1.96,31.79-15.31c8.24-13.34,16.88-36.89,16.88-36.89l10.2,1.57s2.91.31,5.35,3.09,4.43,8.03,7.6,17.31c7.56,22.1,25.12,39.25,25.12,39.25,0,0,5.6,7.43,33.44,12.66,23.08,4.34,42.7-2.46,42.7-2.46,17.72-7.17,21.63-44.96,21.63-44.96,0,0,1.83-13.3,7.81-16.65,7.37-4.14,8.27-4.44,12.71-5.32,3.61-.71.24-13.13,0-16.54ZM190.5,231.32c-9.42,5.1-32.18,7.06-46.31-3.92-14.13-10.99-20.8-30.22-22.76-52.98s7.1-25.23,7.1-25.23c0,0,14.88-.67,34.11,4.03,19.23,4.71,40.42,18.05,40.82,26.69.39,8.63-3.53,46.31-12.95,51.41ZM344.73,255.65c-9.03,4.32-21.47,4.71-31.93,3.92-10.46-.78-37.54-1.57-47.35-31.4,0,0-2.75-14.13-5.1-17.27-2.35-3.14-9.42-14.48-9.42-18.43,0-8.23,7.15-12.97,7.15-12.97,0,0,8.16-5.1,18.75-5.1,10.6,0,64.75,2.75,72.21,12.95,7.46,10.2,7.06,21.98,8.24,31.4,1.18,9.42-3.53,32.57-12.56,36.89Z"/>
      </g>
      <g id="monture-MODERNE" transform="translate(2,-1) scale(1.03,0.99)">
        <path class="cls-4" d="M385.31,180.81c-.24-3.41-9.57-5.22-12.71-6.4-3.14-1.18-15.7,1.96-15.7,1.96-12.17-3.14-54.55-9.03-78.88-9.03s-32.57,11.38-35.32,10.99c-2.75-.39-17.27-.78-23.55-1.96-6.28-1.18-5.1-14.13-39.25-26.48-34.14-12.35-68.29-12.42-68.29-12.42-13.35,4.66-6.76,18.49-6.76,18.49l2.05,6.35c4.32,2.03,3.14,10.52,4.71,23.08s7.46,28.65,14.13,38.46c6.67,9.81,31.79,20.8,44.35,21.19s23.55-1.96,31.79-15.31c8.24-13.34,16.88-36.89,16.88-36.89l10.2,1.57s2.91.31,5.35,3.09,4.43,8.03,7.6,17.31c7.56,22.1,25.12,39.25,25.12,39.25,0,0,5.6,7.43,33.44,12.66,23.08,4.34,42.7-2.46,42.7-2.46,17.72-7.17,21.63-44.96,21.63-44.96,0,0,1.83-13.3,7.81-16.65,7.37-4.14,8.27-4.44,12.71-5.32,3.61-.71.24-13.13,0-16.54ZM190.5,231.32c-9.42,5.1-32.18,7.06-46.31-3.92-14.13-10.99-20.8-30.22-22.76-52.98s7.1-25.23,7.1-25.23c0,0,14.88-.67,34.11,4.03,19.23,4.71,40.42,18.05,40.82,26.69.39,8.63-3.53,46.31-12.95,51.41ZM344.73,255.65c-9.03,4.32-21.47,4.71-31.93,3.92-10.46-.78-37.54-1.57-47.35-31.4,0,0-2.75-14.13-5.1-17.27-2.35-3.14-9.42-14.48-9.42-18.43,0-8.23,7.15-12.97,7.15-12.97,0,0,8.16-5.1,18.75-5.1,10.6,0,64.75,2.75,72.21,12.95,7.46,10.2,7.06,21.98,8.24,31.4,1.18,9.42-3.53,32.57-12.56,36.89Z"/>
      </g>
      <g id="verres-CLASSIQUE">
        <path class="cls-5" d="M116.32,162.87c-.88,6.05.4,37.41,11.44,55.31s37.04,21.35,41.37,21.31,18.51,1.02,24.47-9.27c4.97-8.59,13.17-43.48,9.12-53.05-6.26-14.82-40.4-24.02-40.4-24.02,0,0-26.85-5.46-33.82-4.46,0,0-9.97-.96-12.17,14.17Z"/>
        <path class="cls-5" d="M247.32,192.54s-1.09-9.55,19.57-16.69c11.76-4.06,60.46,3.23,60.46,3.23,0,0,19.09,4.06,21.71,8.28,2.62,4.22,9.46,17.24,8.29,37.97-1.14,20.21-7.31,26.8-12.61,30.31,0,0-7.1,4.93-21.34,5.93-26.65,1.88-37.01-1.14-46.19-7.73-29.88-21.46-29.88-61.3-29.88-61.3Z"/>
      </g>
      <g id="verres-ROND" transform="translate(0,2) scale(0.99)">
        <path class="cls-5" d="M116.32,162.87c-.88,6.05.4,37.41,11.44,55.31s37.04,21.35,41.37,21.31,18.51,1.02,24.47-9.27c4.97-8.59,13.17-43.48,9.12-53.05-6.26-14.82-40.4-24.02-40.4-24.02,0,0-26.85-5.46-33.82-4.46,0,0-9.97-.96-12.17,14.17Z"/>
        <path class="cls-5" d="M247.32,192.54s-1.09-9.55,19.57-16.69c11.76-4.06,60.46,3.23,60.46,3.23,0,0,19.09,4.06,21.71,8.28,2.62,4.22,9.46,17.24,8.29,37.97-1.14,20.21-7.31,26.8-12.61,30.31,0,0-7.1,4.93-21.34,5.93-26.65,1.88-37.01-1.14-46.19-7.73-29.88-21.46-29.88-61.3-29.88-61.3Z"/>
      </g>
      <g id="verres-CARRE" transform="translate(-2,1) scale(1.01,1.02)">
        <path class="cls-5" d="M116.32,162.87c-.88,6.05.4,37.41,11.44,55.31s37.04,21.35,41.37,21.31,18.51,1.02,24.47-9.27c4.97-8.59,13.17-43.48,9.12-53.05-6.26-14.82-40.4-24.02-40.4-24.02,0,0-26.85-5.46-33.82-4.46,0,0-9.97-.96-12.17,14.17Z"/>
        <path class="cls-5" d="M247.32,192.54s-1.09-9.55,19.57-16.69c11.76-4.06,60.46,3.23,60.46,3.23,0,0,19.09,4.06,21.71,8.28,2.62,4.22,9.46,17.24,8.29,37.97-1.14,20.21-7.31,26.8-12.61,30.31,0,0-7.1,4.93-21.34,5.93-26.65,1.88-37.01-1.14-46.19-7.73-29.88-21.46-29.88-61.3-29.88-61.3Z"/>
      </g>
      <g id="verres-MODERNE" transform="translate(1,-1) scale(1.02,0.99)">
        <path class="cls-5" d="M116.32,162.87c-.88,6.05.4,37.41,11.44,55.31s37.04,21.35,41.37,21.31,18.51,1.02,24.47-9.27c4.97-8.59,13.17-43.48,9.12-53.05-6.26-14.82-40.4-24.02-40.4-24.02,0,0-26.85-5.46-33.82-4.46,0,0-9.97-.96-12.17,14.17Z"/>
        <path class="cls-5" d="M247.32,192.54s-1.09-9.55,19.57-16.69c11.76-4.06,60.46,3.23,60.46,3.23,0,0,19.09,4.06,21.71,8.28,2.62,4.22,9.46,17.24,8.29,37.97-1.14,20.21-7.31,26.8-12.61,30.31,0,0-7.1,4.93-21.34,5.93-26.65,1.88-37.01-1.14-46.19-7.73-29.88-21.46-29.88-61.3-29.88-61.3Z"/>
      </g>
    </g>
  </svg>
</div>

<script>
  // @ts-nocheck
  // Client runtime: attach update method to the container element
  (function () {
    if (typeof window === 'undefined') return;

    function applyProps(el, props) {
      if (!el) return;
      const svg = el.querySelector('svg');
      if (!svg) return;

  // support multiple monture variants (monture-CLASSIQUE, monture-ROND, monture-CARRE, monture-MODERNE)
  const monture = svg.querySelector('#monture-' + (props.forme || el.dataset.forme || 'CLASSIQUE').toUpperCase());
  const allMontures = Array.from(svg.querySelectorAll('[id^="monture-"]'));
  // support multiple verres variants (verres-CLASSIQUE, verres-ROND, verres-CARRE, verres-MODERNE)
  const verres = svg.querySelector('#verres-' + (props.forme || el.dataset.forme || 'CLASSIQUE').toUpperCase());
  const allVerres = Array.from(svg.querySelectorAll('[id^="verres-"]'));
      const branches = svg.querySelector('#branches');

      // Map couleur => stroke/fill values for monture
      const couleurMap = {
        NOIR: '#111827',
        MARRON: '#8B4E2F',
        TRANSPARENT: '#ffffff',
        SAUGE: '#9AAE98',
      };
      const couleurKey = (props.couleur || el.dataset.couleur || '').toUpperCase();
      // Tailwind-friendly text color classes to apply on the container
      const twColorMap = {
        NOIR: 'text-black',
        MARRON: 'text-[#8B4E2F]',
        TRANSPARENT: 'text-white',
        SAUGE: 'text-[#9AAE98]',
      };
      const twClass = twColorMap[couleurKey] || 'text-black';

      // remove any previous text- color classes we set (simple approach)
      el.classList.remove('text-black', 'text-[#8B4E2F]', 'text-white', 'text-[#9AAE98]');
      el.classList.add(twClass);

      // Strong inline overrides for monture: set explicit fill/stroke values
      // Use presentation attributes + inline style with !important to override any <style> rules
      const couleurFillMap = {
        NOIR: '#111827',
        MARRON: '#8B4E2F',
        TRANSPARENT: 'none',
        SAUGE: '#9AAE98',
      };
      const fillColor = couleurFillMap[couleurKey] || '#111827';
      // a slightly darker stroke for definition when filled
      const strokeColor = (couleurKey === 'TRANSPARENT') ? '#1d1d1b' : '#0f1724';

      // Hide all monture variants then show the active one
      allMontures.forEach(g => {
        try { g.style.display = 'none'; } catch (e) {}
      });
      if (monture) {
        try { monture.style.display = ''; } catch (e) {}
        monture.querySelectorAll('path, rect, circle, ellipse, polygon, polyline').forEach(el => {
          try {
            if (fillColor === 'none') {
              el.style.setProperty('fill', 'none', 'important');
              el.setAttribute('fill', 'none');
            } else {
              el.style.setProperty('fill', fillColor, 'important');
              el.setAttribute('fill', fillColor);
            }
            // stroke
            el.style.setProperty('stroke', strokeColor, 'important');
            el.setAttribute('stroke', strokeColor);
          } catch (e) { /* ignore individual element failures */ }
        });
      }

      // Map verres styles
      const verresMap = {
        TRANSPARENT: { fill: 'none', opacity: '1', stroke: '#94a3b8' },
        'ANTI-BLEUE': { fill: '#e6eef6', opacity: '1', stroke: '#9fb8d6' },
        SOLAIRE: { fill: '#f3d86a', opacity: '0.9', stroke: '#d4b24a' },
        TRANSITIONS: { fill: '#dfe7f2', opacity: '0.9', stroke: '#b9cbe4' },
      };
      const verresKey = (props.verres || el.dataset.verres || '').toUpperCase();
      const verresStyle = verresMap[verresKey] || verresMap['TRANSPARENT'];
      // Hide all verres variants then show active one and apply styles
      allVerres.forEach(g => { try { g.style.display = 'none'; } catch (e) {} });
      if (verres) {
        try { verres.style.display = ''; } catch (e) {}
        verres.querySelectorAll('path, rect, circle, ellipse, polygon, polyline').forEach(p => {
          try {
            if (verresStyle.fill === 'none') {
              p.style.setProperty('fill', 'none', 'important');
              p.setAttribute('fill', 'none');
            } else {
              p.style.setProperty('fill', verresStyle.fill, 'important');
              p.setAttribute('fill', verresStyle.fill);
            }
            p.setAttribute('opacity', verresStyle.opacity);
            p.style.setProperty('stroke', verresStyle.stroke, 'important');
            p.setAttribute('stroke', verresStyle.stroke);
          } catch (e) { /* ignore */ }
        });

        // add a subtle highlight overlay for non-transparent lenses
        if (verresStyle.fill !== 'none') {
          const hId = 'lens-highlight';
          let hl = verres.querySelector('#' + hId);
          if (!hl) {
            // create a simple translucent highlight path using the first path's bbox
            const first = verres.querySelector('path');
            if (first) {
              const clone = first.cloneNode(true);
              clone.setAttribute('id', hId);
              clone.style.setProperty('fill', '#ffffff', 'important');
              clone.style.setProperty('opacity', '0.08', 'important');
              clone.style.setProperty('mix-blend-mode', 'screen', 'important');
              // slightly shrink/mask the highlight by scaling
              clone.setAttribute('transform', 'translate(6,-6) scale(0.9)');
              verres.appendChild(clone);
            }
          } else {
            // ensure highlight visibility
            hl.style.setProperty('opacity', '0.08', 'important');
          }
        }
      }

      // Material can influence branches color/opacity or add a thin stroke
      const mat = (props.monture || el.dataset.monture || '').toUpperCase();
      if (branches) {
        if (mat === 'METAL' || mat === 'TITANE') {
          branches.querySelectorAll('path').forEach(p => {
            p.setAttribute('stroke', '#9CA3AF');
            p.setAttribute('opacity', '1');
          });
        } else if (mat === 'BOIS') {
          branches.querySelectorAll('path').forEach(p => {
            p.setAttribute('stroke', '#8B5A2B');
            p.setAttribute('opacity', '1');
          });
        } else {
          // default acetate/other
          branches.querySelectorAll('path').forEach(p => {
            p.setAttribute('stroke', '#1d1d1b');
            p.setAttribute('opacity', '1');
          });
        }
      }

      // Adjust monture stroke width for forme
      const formeKey = (props.forme || el.dataset.forme || '').toUpperCase();
      const widths = { CLASSIQUE: 0.6, MODERNE: 0.4, ROND: 0.5, CARRE: 0.7 };
      const w = widths[formeKey] || 0.6;
      if (monture) monture.querySelectorAll('path').forEach(p => p.setAttribute('stroke-width', String(w)));
    }

    function ensureInit(el) {
      if (!el) return;
      if (!el.updateLunettes) {
        el.updateLunettes = function (props = {}) {
          // merge dataset with passed props
          const merged = {
            forme: el.dataset.forme,
            couleur: el.dataset.couleur,
            verres: el.dataset.verres,
            monture: el.dataset.monture,
            ...props
          };
          applyProps(el, merged);
        };
        // initial application from dataset/props
        el.updateLunettes();
      }
    }

    function initAll() {
      document.querySelectorAll('.lunettes-svg').forEach(ensureInit);
    }

    if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', initAll); else initAll();

    // Expose initializer for externally-inserted SVGs
    try {
      Object.defineProperty(window, '__initLunettes', { value: ensureInit, configurable: true });
    } catch (e) { /* ignore */ }
  })();
</script>
