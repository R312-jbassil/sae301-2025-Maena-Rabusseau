---
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header.astro";
import Card from "../components/Card.astro";
import Footer from "../components/Footer.astro";
import LunettesSvg from "../components/Lunettessvg.astro";
const title = "Personnaliser";
---

<Layout title={title}>
    <Header />

    <main class="max-w-7xl mx-auto px-4 py-12">
        <div
            class="bg-(--color-accent) text-white text-sm py-2 px-6 rounded-md mb-8"
        >
            12 personnes regardent ce modèle
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
            <!-- Aperçu (gauche) -->
            <section
                class="lg:col-span-7 bg-white rounded-lg p-10 flex flex-col items-start"
            >
                <a
                    href="/"
                    class="text-sm text-gray-400 mb-6 flex items-center gap-2"
                    >← RETOUR</a
                >
                <p class="text-xs uppercase text-gray-400 tracking-widest mb-4">
                    Personnalisation
                </p>
                <h1 class="text-5xl font-extrabold tracking-tight mb-10">
                    CRÉEZ<br />VOTRE PAIRE
                </h1>

                <div class="w-full flex justify-center">
                    <div class="w-full p-8 rounded-2xl shadow-sm">
                        <div id="svg-container" class="w-full h-auto flex items-center justify-center">
                            <LunettesSvg id="lunettes-svg" class="w-full h-auto object-contain" couleur="NOIR" monture="ACETATE" verres="TRANSPARENT" forme="CLASSIQUE" />
                        </div>

                        <form id="generate-form" class="mt-6 space-y-3" aria-label="Générateur SVG">
                            <div id="generation-alert" class="hidden p-3 rounded text-sm" role="status" aria-live="polite"></div>
                            <label for="user-prompt" class="sr-only">Description</label>
                            <textarea
                                id="user-prompt"
                                rows="3"
                                class="w-full border rounded p-2 text-sm"
                                placeholder="Décrivez le style de lunettes que vous voulez (ex: monture ronde fine noire, verres légèrement teintés)..."
                            ></textarea>

                            <div class="flex gap-3">
                                <button
                                    id="generate-button"
                                    type="button"
                                    class="bg-(--color-accent) text-white px-4 py-2 rounded text-sm"
                                    aria-live="polite"
                                >
                                    Générer SVG
                                </button>
                                <button
                                    id="edit-button"
                                    type="button"
                                    class="border px-4 py-2 rounded text-sm"
                                >
                                    Éditer
                                </button>
                            </div>

                            <div id="svg-output" class="sr-only" aria-hidden="true"></div>
                        </form>
                    </div>
                </div>

                <div class="mt-8 flex items-center justify-center">
                    <button
                        class="border border-gray-300 text-sm px-4 py-2 rounded-md inline-flex items-center justify-center"
                        >STOCK LIMITÉ : Plus que 4 en stock</button
                    >
                </div>
            </section>

            <!-- Contrôles (droite) -->
            <aside class="lg:col-span-5">
                <div class="space-y-10">
                    <!-- 01. FORME -->
                    <div>
                        <h3 class="text-sm font-semibold text-gray-700">
                            01. FORME
                        </h3>
                        <p class="text-xs text-gray-400 mb-4">
                            Choisissez votre style de monture
                        </p>

                        <div
                            class="grid grid-cols-2 gap-4"
                            data-group="forme"
                            data-single="true"
                        >
                            <input type="hidden" name="forme" value="" />
                            <button
                                type="button"
                                data-group="forme"
                                data-value="CLASSIQUE"
                                aria-pressed="false"
                                class="p-4 border rounded-md shadow-sm hover:shadow-md text-left"
                            >
                                <div class="h-6 bg-gray-200 rounded-sm mb-3">
                                </div>
                                <div class="text-xs font-medium text-gray-700">
                                    CLASSIQUE
                                </div>
                                <div class="text-xs text-gray-400">198€</div>
                            </button>

                            <button
                                type="button"
                                data-group="forme"
                                data-value="MODERNE"
                                aria-pressed="false"
                                class="p-4 border rounded-md shadow-sm hover:shadow-md text-left"
                            >
                                <div class="h-6 bg-gray-200 rounded-sm mb-3">
                                </div>
                                <div class="text-xs font-medium text-gray-700">
                                    MODERNE
                                </div>
                                <div class="text-xs text-gray-400">
                                    218€ <span
                                        class="inline-block ml-2 bg-(--color-accent) text-white text-[10px] px-2 py-0.5 rounded"
                                        >BESTSELLER</span
                                    >
                                </div>
                            </button>

                            <button
                                type="button"
                                data-group="forme"
                                data-value="ROND"
                                aria-pressed="false"
                                class="p-4 border rounded-md shadow-sm hover:shadow-md text-left"
                            >
                                <div class="h-6 bg-gray-200 rounded-sm mb-3">
                                </div>
                                <div class="text-xs font-medium text-gray-700">
                                    ROND
                                </div>
                                <div class="text-xs text-gray-400">206€</div>
                            </button>

                            <button
                                type="button"
                                data-group="forme"
                                data-value="CARRE"
                                aria-pressed="false"
                                class="p-4 border rounded-md shadow-sm hover:shadow-md text-left"
                            >
                                <div class="h-6 bg-gray-200 rounded-sm mb-3">
                                </div>
                                <div class="text-xs font-medium text-gray-700">
                                    CARRÉ
                                </div>
                                <div class="text-xs text-gray-400">198€</div>
                            </button>
                        </div>
                    </div>

                    <!-- 02. COULEUR -->
                    <div>
                        <h3 class="text-sm font-semibold text-gray-700">
                            02. COULEUR
                        </h3>
                        <p class="text-xs text-gray-400 mb-4">
                            Sélectionnez votre finition
                        </p>

                        <div
                            class="grid grid-cols-4 gap-3"
                            data-group="couleur"
                            data-single="true"
                        >
                            <input type="hidden" name="couleur" value="" />
                            <button
                                type="button"
                                data-group="couleur"
                                data-value="NOIR"
                                aria-pressed="false"
                                class="w-16 h-16 rounded shadow-sm border"
                            >
                                <span
                                    class="block w-full h-full bg-black rounded"
                                ></span>
                            </button>
                            <button
                                type="button"
                                data-group="couleur"
                                data-value="MARRON"
                                aria-pressed="false"
                                class="w-16 h-16 rounded shadow-sm border"
                            >
                                <span
                                    class="block w-full h-full bg-[#8B4E2F] rounded"
                                ></span>
                            </button>
                            <button
                                type="button"
                                data-group="couleur"
                                data-value="TRANSPARENT"
                                aria-pressed="false"
                                class="w-16 h-16 rounded shadow-sm border"
                            >
                                <span
                                    class="block w-full h-full bg-white border rounded"
                                ></span>
                            </button>
                            <button
                                type="button"
                                data-group="couleur"
                                data-value="SAUGE"
                                aria-pressed="false"
                                class="w-16 h-16 rounded shadow-sm border"
                            >
                                <span
                                    class="block w-full h-full bg-[#9AAE98] rounded"
                                ></span>
                            </button>
                        </div>
                    </div>

                    <!-- 03. VERRES -->
                    <div class="mt-12">
                        <h3 class="text-sm font-semibold text-gray-700">
                            03. VERRES
                        </h3>
                        <p class="text-xs text-gray-400 mb-4">
                            Type de correction
                        </p>

                        <div
                            class="space-y-3"
                            data-group="verres"
                            data-single="true"
                        >
                            <input type="hidden" name="verres" value="" />
                            <button
                                type="button"
                                data-group="verres"
                                data-value="TRANSPARENT"
                                aria-pressed="false"
                                class="block w-full text-left border rounded-md p-4"
                            >
                                <div class="flex items-center justify-between">
                                    <div>
                                        <div class="text-sm font-medium">
                                            TRANSPARENT
                                        </div>
                                        <div class="text-xs text-gray-400">
                                            Verres standards
                                        </div>
                                    </div>
                                    <div class="text-sm text-gray-700">
                                        Inclus
                                    </div>
                                </div>
                            </button>

                            <button
                                type="button"
                                data-group="verres"
                                data-value="ANTI-BLEUE"
                                aria-pressed="false"
                                class="block w-full text-left border rounded-md p-4"
                            >
                                <div class="flex items-center justify-between">
                                    <div>
                                        <div class="text-sm font-medium">
                                            ANTI-LUMIÈRE BLEUE
                                        </div>
                                        <div class="text-xs text-gray-400">
                                            Protection écrans
                                        </div>
                                    </div>
                                    <div class="text-sm text-gray-700">
                                        +40€
                                    </div>
                                </div>
                            </button>

                            <button
                                type="button"
                                data-group="verres"
                                data-value="SOLAIRE"
                                aria-pressed="false"
                                class="block w-full text-left border rounded-md p-4"
                            >
                                <div class="flex items-center justify-between">
                                    <div>
                                        <div class="text-sm font-medium">
                                            SOLAIRE
                                        </div>
                                        <div class="text-xs text-gray-400">
                                            Protection UV
                                        </div>
                                    </div>
                                    <div class="text-sm text-gray-700">
                                        +60€
                                    </div>
                                </div>
                            </button>

                            <button
                                type="button"
                                data-group="verres"
                                data-value="TRANSITIONS"
                                aria-pressed="false"
                                class="block w-full text-left border rounded-md p-4"
                            >
                                <div class="flex items-center justify-between">
                                    <div>
                                        <div class="text-sm font-medium">
                                            TRANSITIONS
                                        </div>
                                        <div class="text-xs text-gray-400">
                                            S'adapte à la lumière
                                        </div>
                                    </div>
                                    <div class="text-sm text-gray-700">
                                        +80€
                                    </div>
                                </div>
                            </button>
                        </div>
                    </div>

                    <!-- 04. MATÉRIAUX -->
                    <div class="mt-12">
                        <h3 class="text-sm font-semibold text-gray-700">
                            04. MATÉRIAUX
                        </h3>
                        <p class="text-xs text-gray-400 mb-6">
                            Sélectionnez les matériaux pour chaque partie
                        </p>

                        <div class="mb-6">
                            <div class="text-xs text-gray-500 mb-3">
                                MONTURE
                            </div>
                            <div
                                class="grid grid-cols-2 gap-4"
                                data-group="monture"
                                data-single="true"
                            >
                                <input type="hidden" name="monture" value="" />
                                <button
                                    type="button"
                                    data-group="monture"
                                    data-value="ACETATE"
                                    aria-pressed="false"
                                    class="block border rounded-md p-4 text-left"
                                >
                                    <div class="text-sm font-medium">
                                        ACÉTATE
                                    </div>
                                    <div class="text-xs text-gray-400">
                                        Léger et durable
                                    </div>
                                    <div class="text-xs mt-2">Inclus</div>
                                </button>
                                <button
                                    type="button"
                                    data-group="monture"
                                    data-value="METAL"
                                    aria-pressed="false"
                                    class="block border rounded-md p-4 text-left"
                                >
                                    <div class="text-sm font-medium">MÉTAL</div>
                                    <div class="text-xs text-gray-400">
                                        Élégant et fin
                                    </div>
                                    <div class="text-xs mt-2">+30€</div>
                                </button>
                                <button
                                    type="button"
                                    data-group="monture"
                                    data-value="TITANE"
                                    aria-pressed="true"
                                    class="block border-2 border-black rounded-md p-4 text-left relative"
                                >
                                    <div
                                        class="absolute -top-3 -right-3 bg-(--color-accent) text-white rounded-full w-6 h-6 flex items-center justify-center text-xs"
                                    >
                                        ✓
                                    </div>
                                    <div class="text-sm font-medium">
                                        TITANE
                                    </div>
                                    <div class="text-xs text-gray-400">
                                        Ultra-léger et résistant
                                    </div>
                                    <div class="text-xs mt-2">+80€</div>
                                </button>
                                <button
                                    type="button"
                                    data-group="monture"
                                    data-value="BOIS"
                                    aria-pressed="false"
                                    class="block border rounded-md p-4 text-left"
                                >
                                    <div class="text-sm font-medium">BOIS</div>
                                    <div class="text-xs text-gray-400">
                                        Unique et écologique
                                    </div>
                                    <div class="text-xs mt-2">+120€</div>
                                </button>
                            </div>
                        </div>

                        <div>
                            <div class="text-xs text-gray-500 mb-3">
                                BRANCHES
                            </div>
                            <div
                                class="grid grid-cols-2 gap-4"
                                data-group="branches"
                                data-single="true"
                            >
                                <input type="hidden" name="branches" value="" />
                                <button
                                    type="button"
                                    data-group="branches"
                                    data-value="ACETATE"
                                    aria-pressed="false"
                                    class="block border rounded-md p-4 text-left"
                                >
                                    <div class="text-sm font-medium">
                                        ACÉTATE
                                    </div>
                                    <div class="text-xs text-gray-400">
                                        Léger et durable
                                    </div>
                                    <div class="text-xs mt-2">Inclus</div>
                                </button>
                                <button
                                    type="button"
                                    data-group="branches"
                                    data-value="METAL"
                                    aria-pressed="false"
                                    class="block border rounded-md p-4 text-left"
                                >
                                    <div class="text-sm font-medium">MÉTAL</div>
                                    <div class="text-xs text-gray-400">
                                        Élégant et fin
                                    </div>
                                    <div class="text-xs mt-2">+30€</div>
                                </button>
                                <button
                                    type="button"
                                    data-group="branches"
                                    data-value="TITANE"
                                    aria-pressed="true"
                                    class="block border-2 border-black rounded-md p-4 text-left relative"
                                >
                                    <div
                                        class="absolute -top-3 -right-3 bg-(--color-accent) text-white rounded-full w-6 h-6 flex items-center justify-center text-xs"
                                    >
                                        ✓
                                    </div>
                                    <div class="text-sm font-medium">
                                        TITANE
                                    </div>
                                    <div class="text-xs text-gray-400">
                                        Ultra-léger et résistant
                                    </div>
                                    <div class="text-xs mt-2">+80€</div>
                                </button>
                                <button
                                    type="button"
                                    data-group="branches"
                                    data-value="BOIS"
                                    aria-pressed="false"
                                    class="block border rounded-md p-4 text-left"
                                >
                                    <div class="text-sm font-medium">BOIS</div>
                                    <div class="text-xs text-gray-400">
                                        Unique et écologique
                                    </div>
                                    <div class="text-xs mt-2">+120€</div>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 05. DIMENSIONS -->
                    <div class="mt-12">
                        <h3 class="text-sm font-semibold text-gray-700">
                            05. DIMENSIONS
                        </h3>
                        <p class="text-xs text-gray-400 mb-6">
                            Ajustez les mesures à votre convenance
                        </p>

                        <div class="mb-6">
                            <div
                                class="flex justify-between text-xs text-gray-500 mb-2"
                            >
                                <div>LARGEUR DU PONT</div>
                                <div class="text-sm text-gray-700">19mm</div>
                            </div>
                            <input
                                type="range"
                                min="14"
                                max="24"
                                value="19"
                                class="w-full h-2 bg-gray-200 rounded-lg"
                            />
                            <div
                                class="flex justify-between text-xs text-gray-400 mt-2"
                            >
                                <div>14mm (Étroi t)</div>
                                <div>24mm (Large)</div>
                            </div>
                        </div>

                        <div class="mb-6">
                            <div
                                class="flex justify-between text-xs text-gray-500 mb-2"
                            >
                                <div>TAILLE DES VERRES</div>
                                <div class="text-sm text-gray-700">48mm</div>
                            </div>
                            <input
                                type="range"
                                min="45"
                                max="60"
                                value="48"
                                class="w-full h-2 bg-gray-200 rounded-lg"
                            />
                            <div
                                class="flex justify-between text-xs text-gray-400 mt-2"
                            >
                                <div>45mm (Petit)</div>
                                <div>60mm (Grand)</div>
                            </div>
                        </div>

                        <div class="mt-6 bg-gray-50 p-6 rounded">
                            <div class="text-sm text-gray-500 mb-4">
                                MESURES FINALES
                            </div>
                            <div class="grid grid-cols-3 text-center">
                                <div>
                                    <div class="text-xs text-gray-500">
                                        Pont
                                    </div>
                                    <div class="font-semibold">19mm</div>
                                </div>
                                <div>
                                    <div class="text-xs text-gray-500">
                                        Verres
                                    </div>
                                    <div class="font-semibold">48mm</div>
                                </div>
                                <div>
                                    <div class="text-xs text-gray-500">
                                        Largeur totale
                                    </div>
                                    <div class="font-semibold">115mm</div>
                                </div>
                            </div>
                        </div>

                        <aside class="bg-white rounded border p-6 mt-15">
                            <div class="text-sm font-semibold mb-3">
                                OPTIONS SUPPLÉMENTAIRES
                            </div>
                            <ul class="text-sm text-gray-600 space-y-2">
                                <li>Gravure personnalisée</li>
                                <li>Étui premium</li>
                                <li>Chiffon microfibre</li>
                            </ul>
                        </aside>
                    </div>

                    <!-- Récap total + options (large) -->
                    <div class="mt-12 gap-8 items-center">
                        <div class="lg:col-span-2 bg-white p-6 rounded border">
                            <div
                                class="flex justify-between text-sm text-gray-600 mb-4"
                            >
                                <div>
                                    <div>Monture</div>
                                </div>
                                <div class="text-lg font-bold">200€</div>
                            </div>

                            <div
                                class="flex justify-between text-sm text-gray-600 mb-6"
                            >
                                <div>
                                    <div>Verres</div>
                                </div>
                                <div class="text-lg font-bold">80€</div>
                            </div>

                            <div
                                class="border-t pt-6 flex items-center justify-between"
                            >
                                <div class="text-sm font-semibold">TOTAL</div>
                                <div class="text-2xl font-bold">280€</div>
                            </div>

                            <div class="mt-6">
                                <button
                                    class="w-full bg-(--color-accent) text-white py-3 text-xs tracking-widest rounded"
                                    >AJOUTER AU PANIER</button
                                >
                            </div>
                        </div>
                    </div>
                </div>
            </aside>
        </div>

        <script>
            // @ts-nocheck
         
            (function () {
                function initGroup(groupEl) {
                    const name = groupEl.dataset.group;
                    const single = groupEl.dataset.single === "true";
                    const hidden = groupEl.querySelector(
                        'input[type="hidden"][name="' + name + '"]',
                    );
                    const buttons = Array.from(
                        groupEl.querySelectorAll("button[data-value]"),
                    );
                    // initialize hidden from any button preselected (aria-pressed true)
                    const pre = buttons.find(
                        (b) => b.getAttribute("aria-pressed") === "true",
                    );
                    if (pre && hidden) hidden.value = pre.dataset.value;

                    buttons.forEach((btn) => {
                        btn.addEventListener("click", () => {
                            const isSelected =
                                btn.getAttribute("aria-pressed") === "true";
                            if (single) {
                                if (isSelected) {
                                    // deselect
                                    btn.setAttribute("aria-pressed", "false");
                                    btn.classList.remove(
                                        "ring-2",
                                        "ring-(--color-accent)",
                                        "border-2",
                                        "border-black",
                                    );
                                    if (hidden) hidden.value = "";
                                } else {
                                    // deselect others
                                    buttons.forEach((b) => {
                                        b.setAttribute("aria-pressed", "false");
                                        b.classList.remove(
                                            "ring-2",
                                            "ring-(--color-accent)",
                                            "border-2",
                                            "border-black",
                                        );
                                    });
                                    btn.setAttribute("aria-pressed", "true");
                                    btn.classList.add(
                                        "ring-2",
                                        "ring-(--color-accent)",
                                        "border-2",
                                        "border-black",
                                    );
                    if (hidden)
                        hidden.value = btn.dataset.value;
                    // notify preview to update
                    try {
                        if (typeof window !== 'undefined' && typeof window.updatePreview === 'function') window.updatePreview();
                    } catch (e) { /* ignore */ }
                                }
                            } else {
                                // multi-toggle
                                if (isSelected) {
                                    btn.setAttribute("aria-pressed", "false");
                                    btn.classList.remove(
                                        "ring-2",
                                        "ring-(--color-accent)",
                                        "border-2",
                                        "border-black",
                                    );
                                } else {
                                    btn.setAttribute("aria-pressed", "true");
                                    btn.classList.add(
                                        "ring-2",
                                        "ring-(--color-accent)",
                                        "border-2",
                                        "border-black",
                                    );
                                }
                                if (hidden) {
                                    const vals = buttons
                                        .filter(
                                            (b) =>
                                                b.getAttribute(
                                                    "aria-pressed",
                                                ) === "true",
                                        )
                                        .map((b) => b.dataset.value);
                                    hidden.value = vals.join(",");
                                }
                            }
                        });
                        // keyboard accessibility: toggle with space/enter
                        btn.addEventListener("keydown", (e) => {
                            if (e.key === " " || e.key === "Enter") {
                                e.preventDefault();
                                btn.click();
                            }
                        });
                    });
                }

                document.addEventListener("DOMContentLoaded", () => {
                    document
                        .querySelectorAll("[data-group]")
                        .forEach(initGroup);
                });
            })();

            // global helper to read selected hidden inputs and update the LunettesSvg component
            window.updatePreview = function () {
                try {
                    const get = (name) => {
                        const el = document.querySelector('input[type="hidden"][name="' + name + '"]');
                        return el ? el.value || '' : '';
                    };
                    const forme = get('forme');
                    const couleur = get('couleur');
                    const verres = get('verres');
                    const monture = get('monture');

                    const comp = document.getElementById('lunettes-svg');
                    if (!comp) return;
                    if (typeof comp.updateLunettes !== 'function' && typeof window.__initLunettes === 'function') {
                        window.__initLunettes(comp);
                    }
                    if (typeof comp.updateLunettes === 'function') {
                        comp.updateLunettes({ forme, couleur, verres, monture });
                    }
                } catch (e) { /* ignore */ }
            };
        </script>
    </main>
    <Footer />
</Layout>






<!-- IA -->

<script>
    // @ts-nocheck
       let promptList = [];
    (function () {
        async function generateSVG(prompt) {
            console.log("Generating SVG for prompt:", prompt);
            const res = await fetch("/api2/generateSVG", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(prompt ),
            });
            // essayer de parser le JSON quelle que soit la réponse
            let data = null;
            try {
                data = await res.json();
            } catch (e) {
                const txt = await res.text();
                throw new Error("Réponse invalide de l'API: " + txt);
            }

            if (!res.ok) {
                // erreur renvoyée par l'API (ex: clé manquante). On renvoie l'objet d'erreur pour le handler.
                const err = new Error(data?.message || "Erreur API");
                err.payload = data;
                throw err;
            }

            return data.svg;
        }

        async function handleSubmit(e) {
            e?.preventDefault();
            const promptEl = document.getElementById("user-prompt");
            const generateButton = document.getElementById("generate-button");
            const svgContainer = document.getElementById("svg-container");
            const svgOutput = document.getElementById("svg-output");

            if (!promptEl || !generateButton || !svgContainer || !svgOutput) {
                console.warn(
                    "Éléments requis manquants: user-prompt, generate-button, svg-container, svg-output",
                );
                return;
            }

            const prompt = String(promptEl.value || "").trim();
            if (!prompt) {
                svgOutput.textContent = "Veuillez entrer une description.";
                return;
            }

            generateButton.disabled = true;
            generateButton.setAttribute("aria-busy", "true");
            svgOutput.textContent = "Génération en cours...";

            const alertEl = document.getElementById("generation-alert");
            try {
                // clear alert
                if (alertEl) {
                    alertEl.className = "hidden p-3 rounded text-sm";
                    alertEl.textContent = "";
                }
                promptList.push(prompt);
                const svgCode = await generateSVG(promptList);
                if (!svgCode) throw new Error("Aucun SVG retourné par l'API");
                // afficher le SVG rendu et le code source
                svgContainer.innerHTML = svgCode;
                svgOutput.textContent = svgCode;
                    // if the injected SVG contains our component/container, initialize it
                    try {
                        const comp = svgContainer.querySelector('.lunettes-svg') || svgContainer.querySelector('#lunettes-svg');
                        if (comp && typeof window.__initLunettes === 'function') window.__initLunettes(comp);
                        if (typeof window.updatePreview === 'function') window.updatePreview();
                    } catch (e) { /* ignore */ }
            } catch (err) {
                console.error(err);
                const payload = err?.payload || null;
                const message = payload?.message || err?.message || "Erreur lors de la génération";
                if (alertEl) {
                    alertEl.className = "bg-yellow-50 border-l-4 border-yellow-400 text-yellow-700 p-3 rounded text-sm";
                    alertEl.textContent = message + (payload?.hint ? " — " + payload.hint : "");
                } else {
                    svgOutput.textContent = "Erreur: " + message;
                }
            } finally {
                generateButton.disabled = false;
                generateButton.removeAttribute("aria-busy");
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            const generateButton = document.getElementById("generate-button");
            if (generateButton)
                generateButton.addEventListener("click", handleSubmit);

            const form = document.getElementById("generate-form");
            if (form) form.addEventListener("submit", handleSubmit);
        });
    })();
</script>



